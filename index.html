<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOFTLOG v1.2 | By Surabhi</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #050505;
            --bg-light: #0a0a0a;
            --card-bg: rgba(20, 20, 20, 0.6);
            --nav-bg: rgba(10, 10, 10, 0.8);
            
            --accent: #8b5cf6; /* Default Purple */
            --accent-glow: rgba(139, 92, 246, 0.4);
            
            --border: rgba(255, 255, 255, 0.08);
            --border-highlight: rgba(255, 255, 255, 0.15);
            
            --text: #ffffff;
            --text-dim: #888890;
            --text-muted: #555560;
            
            --danger: #ff4d4d;
            --warning: #ffb300;
            --success: #00e676;
            
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-dark); 
            background-image: radial-gradient(circle at 50% 0%, #1a1a20 0%, var(--bg-dark) 60%);
            color: var(--text); 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 0 0 var(--accent-glow); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; inset: 0; background: #000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        .logo-box {
            font-size: 48px; font-weight: 800; letter-spacing: -2px;
            background: linear-gradient(135deg, #fff 20%, var(--accent) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px var(--accent-glow));
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); z-index: 5000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            padding: 30px; opacity: 0; transition: opacity 0.5s ease;
        }
        #login-screen.visible { opacity: 1; }
        .login-card {
            background: var(--card-bg); border: 1px solid var(--border);
            padding: 40px; border-radius: 30px; width: 100%; max-width: 400px;
            text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .login-input { 
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; 
            padding: 18px 20px; border-radius: 14px; margin-bottom: 12px; outline: none; 
            font-size: 15px; transition: 0.3s; 
        }
        .login-input:focus { border-color: var(--accent); background: rgba(0,0,0,0.5); }
        .btn-login { 
            width: 100%; background: var(--accent); color: white; border: none; 
            padding: 18px; border-radius: 14px; font-weight: 700; cursor: pointer; 
            font-size: 16px; margin-top: 20px; box-shadow: 0 10px 30px -10px var(--accent);
            transition: 0.3s;
        }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 15px 35px -10px var(--accent); }

        /* --- SIDEBAR --- */
        .sidebar { 
            width: 280px; background: var(--nav-bg); border-right: 1px solid var(--border); 
            padding: 40px 25px; display: flex; flex-direction: column; z-index: 100; 
            backdrop-filter: blur(10px);
        }
        .brand-container { margin-bottom: 50px; }
        .brand-name { 
            font-size: 28px; font-weight: 800; letter-spacing: -1px; 
            color: var(--accent); 
            text-shadow: 0 0 15px var(--accent-glow);
        }
        .brand-by { font-size: 12px; font-weight: 600; color: var(--text-dim); margin-top: 5px; letter-spacing: 0.5px; }
        
        .nav-btn { 
            padding: 16px 20px; border-radius: 16px; cursor: pointer; transition: 0.3s; 
            font-size: 14px; font-weight: 600; color: var(--text-dim); display: flex; align-items: center; gap: 15px; 
            margin-bottom: 8px; border: 1px solid transparent; 
        }
        .nav-btn:hover { background: rgba(255,255,255,0.03); color: #fff; }
        .nav-btn.active { 
            background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, transparent 100%);
            border-left: 3px solid var(--accent);
            color: #fff; border-radius: 6px 16px 16px 6px;
        }
        
        .ver-area { margin-top: auto; padding-top: 25px; border-top: 1px solid var(--border); }
        .side-user { 
            font-size: 16px; font-weight: 700; 
            color: var(--accent); 
            display: block; margin-bottom: 4px; 
            text-shadow: 0 0 10px var(--accent-glow);
        }
        .side-comp { font-size: 12px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        /* --- MOBILE NAV --- */
        .mobile-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(10,10,10,0.9); backdrop-filter: blur(20px); border-top: 1px solid var(--border); padding: 15px 20px calc(15px + var(--safe-bottom)); justify-content: space-between; z-index: 1000; }
        .mobile-header { display: none; padding: 20px; border-bottom: 1px solid var(--border); background: var(--bg-dark); text-align: center; }
        .mobile-logo { font-weight: 800; font-size: 18px; letter-spacing: -0.5px; color: var(--accent); }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .tab-panel { display: none; padding: 30px; height: 100%; max-width: 1000px; margin: 0 auto; width: 100%; overflow-y: auto; }
        .tab-panel.active { display: flex; flex-direction: column; animation: fadeIn 0.4s ease-out; }
        
        /* --- DASHBOARD ELEMENTS --- */
        .status-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .status-chip { 
            background: var(--card-bg); padding: 8px 16px; border-radius: 30px; border: 1px solid var(--border); 
            font-size: 12px; font-weight: 700; color: var(--text-dim); display: flex; align-items: center; gap: 8px;
        }
        .status-dot { width: 8px; height: 8px; background: var(--text-dim); border-radius: 50%; }
        .status-dot.active { background: var(--success); box-shadow: 0 0 10px var(--success); }

        .clock-container { text-align: center; margin: 20px 0 50px 0; position: relative; }
        .clock-label { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin-bottom: 10px; }
        .master-clock { 
            font-size: clamp(60px, 15vw, 100px); font-weight: 800; letter-spacing: -4px; line-height: 1;
            background: linear-gradient(180deg, #fff 0%, var(--accent) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px var(--accent-glow));
        }

        .action-bar { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; }
        .big-btn {
            background: var(--card-bg); border: 1px solid var(--border); color: #fff;
            padding: 15px 30px; border-radius: 20px; font-weight: 700; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; gap: 10px; font-size: 14px;
        }
        .big-btn:hover { background: rgba(255,255,255,0.05); border-color: var(--border-highlight); transform: translateY(-2px); }
        .punch-btn-main {
            background: var(--text); color: #000; border: none; padding: 15px 40px;
            font-weight: 800; border-radius: 20px; box-shadow: 0 10px 30px rgba(255,255,255,0.1);
            transition: 0.3s; cursor: pointer;
        }
        .punch-btn-main:hover { transform: scale(1.05); box-shadow: 0 15px 40px rgba(255,255,255,0.2); }
        .punch-btn-main.out { background: var(--danger); color: #fff; box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3); }

        /* --- TASK CARDS --- */
        .task-list-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .task-card { 
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 25px; 
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; 
            transition: 0.3s; backdrop-filter: blur(10px);
        }
        .task-card:hover { border-color: var(--border-highlight); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        
        .task-card.active-task { 
            border-color: var(--accent); background: linear-gradient(90deg, rgba(139, 92, 246, 0.05) 0%, transparent 100%);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.1);
        }

        .task-info h3 { font-size: 18px; font-weight: 700; margin-bottom: 5px; }
        .task-meta { display: flex; gap: 10px; align-items: center; }
        .task-cat { font-size: 10px; font-weight: 700; background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 6px; text-transform: uppercase; color: var(--text-dim); }
        .task-time { font-family: monospace; font-size: 14px; color: var(--accent); font-weight: 700; }

        .task-controls { display: flex; gap: 10px; align-items: center; }
        .btn-icon { 
            width: 40px; height: 40px; border-radius: 12px; border: 1px solid transparent; 
            background: transparent; color: var(--text-muted); cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; font-size: 16px;
        }
        .btn-icon:hover { color: var(--danger); background: rgba(255, 77, 77, 0.1); }
        
        .play-toggle { 
            width: 50px; height: 50px; border-radius: 16px; background: #fff; color: #000; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px;
            transition: 0.3s; box-shadow: 0 5px 15px rgba(255,255,255,0.1);
        }
        .play-toggle:hover { transform: scale(1.1); }
        .play-toggle.playing { background: var(--accent); color: #fff; animation: pulseGlow 2s infinite; }

        /* --- HISTORY UI --- */
        .cal-container { background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 25px; margin-bottom: 25px; }
        .cal-header { display: flex; gap: 15px; margin-bottom: 20px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .cal-day { 
            aspect-ratio: 1; border-radius: 12px; display: flex; align-items: center; justify-content: center; 
            font-size: 13px; font-weight: 600; color: var(--text-muted); cursor: pointer; transition: 0.2s; border: 1px solid transparent; 
        }
        .cal-day:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .cal-day.has-data { color: var(--accent); background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.2); }
        .cal-day.selected { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3); }
        .cal-day.leave-full { background: rgba(255, 77, 77, 0.1); color: var(--danger); border-color: var(--danger); }
        .cal-day.leave-half { background: rgba(255, 179, 0, 0.1); color: var(--warning); border-color: var(--warning); }

        /* --- SETTINGS UI --- */
        .settings-group { margin-bottom: 30px; }
        .settings-label { font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; padding-left: 10px; }
        .settings-list { background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; overflow: hidden; }
        .setting-item { 
            padding: 20px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--border); 
            cursor: pointer; transition: 0.2s; 
        }
        .setting-item:last-child { border-bottom: none; }
        .setting-item:hover { background: rgba(255,255,255,0.02); }
        .setting-icon { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; font-size: 18px; }

        /* --- MODALS --- */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); display: none; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .modal-box { background: #111; width: 100%; max-width: 450px; padding: 35px; border-radius: 30px; border: 1px solid var(--border); box-shadow: 0 30px 60px rgba(0,0,0,0.5); transform: translateY(0); transition: 0.3s; }
        .modal h2 { margin-bottom: 25px; font-size: 24px; }
        
        /* --- FAB --- */
        .fab { 
            position: fixed; bottom: 30px; right: 30px; width: 64px; height: 64px; 
            background: #fff; color: #000; border-radius: 20px; 
            display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 300;
            cursor: pointer; z-index: 900; box-shadow: 0 10px 30px rgba(255,255,255,0.15);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .fab:hover { transform: scale(1.1) rotate(90deg); }

        /* --- COLORS --- */
        .color-grid { display: flex; gap: 15px; }
        .color-dot { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.3s; position: relative; }
        .color-dot.active { border-color: #fff; transform: scale(1.15); }

        @media (min-width: 769px) { body { flex-direction: row; } .history-grid-layout { grid-template-columns: 350px 1fr; gap: 30px; display: grid; height: 100%; } .mobile-nav, .mobile-header { display: none; } }
        @media (max-width: 768px) { .sidebar { display: none; } .mobile-nav { display: flex; } .mobile-header { display: block; } .history-grid-layout { display: flex; flex-direction: column; } .fab { bottom: 100px; } }
        @media print { .no-print { display: none !important; } body { background: white; color: black; } }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="logo-box">SOFTLOG</div>
        <div style="font-size: 12px; color: #666; margin-top: 10px; letter-spacing: 2px;">V 1.2</div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-card">
            <div class="logo-box" style="font-size: 36px; margin-bottom: 10px;">SOFTLOG</div>
            <p style="color: var(--text-dim); margin-bottom: 30px; font-size: 14px;">Workspace Access</p>
            
            <input type="text" id="reg-comp" class="login-input" placeholder="Company Name">
            <input type="text" id="reg-user" class="login-input" placeholder="Your Name">
            <input type="text" id="reg-desig" class="login-input" placeholder="Designation">
            
            <button onclick="completeRegistration()" class="btn-login">Initialize System</button>
        </div>
    </div>

    <header class="mobile-header"><span class="mobile-logo">SOFTLOG v1.2</span></header>

    <aside class="sidebar">
        <div class="brand-container">
            <div class="brand-name">SOFTLOG</div>
            <div class="brand-by">By Surabhi</div>
        </div>
        <nav style="flex: 1;">
            <div class="nav-btn active" id="d-dashboard" onclick="switchTab('dashboard')"><span>üíº</span> Dashboard</div>
            <div class="nav-btn" id="d-history" onclick="switchTab('history')"><span>üìÖ</span> Activity Logs</div>
            <div class="nav-btn" id="d-settings" onclick="switchTab('settings')"><span>‚öôÔ∏è</span> System</div>
        </nav>
        <div class="ver-area">
            <span class="side-user" id="side-user-name">Guest User</span>
            <span class="side-comp" id="side-comp-name">SOFTLOG INC.</span>
            <div style="margin-top: 15px; font-size: 10px; color: var(--text-muted);">VERSION 1.2</div>
        </div>
    </aside>

    <nav class="mobile-nav">
        <div class="nav-btn active" id="m-dashboard" onclick="switchTab('dashboard')" style="flex-direction: column; gap: 5px; font-size: 10px;"><span>üíº</span></div>
        <div class="nav-btn" id="m-history" onclick="switchTab('history')" style="flex-direction: column; gap: 5px; font-size: 10px;"><span>üìÖ</span></div>
        <div class="nav-btn" id="m-settings" onclick="switchTab('settings')" style="flex-direction: column; gap: 5px; font-size: 10px;"><span>‚öôÔ∏è</span></div>
    </nav>

    <main class="main-content">
        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-panel active">
            <div class="status-header">
                <div class="status-chip">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="punch-status-text">Offline</span>
                </div>
                <div style="font-family: monospace; font-weight: 700; color: var(--text-dim);" id="punch-time-display">--:--</div>
            </div>

            <div class="clock-container">
                <div class="clock-label">Total Time Tracked</div>
                <div class="master-clock" id="master-clock">00:00:00</div>
            </div>

            <div class="action-bar">
                <button class="punch-btn-main" id="punch-btn" onclick="handlePunch()">Punch In</button>
            </div>

            <div class="task-list-title">
                <span>Active Tasks</span>
                <span style="font-size: 12px; color: var(--text-muted);" id="task-count">0 Tasks</span>
            </div>
            
            <div id="task-list" style="padding-bottom: 80px;"></div>
        </div>

        <!-- HISTORY -->
        <div id="history" class="tab-panel">
            <div class="task-list-title">
                <span style="font-size: 24px;">Logs</span>
                <div style="display:flex; gap:10px;">
                    <button class="big-btn" style="padding: 10px 20px;" onclick="promptLeaveOptions()">Leave</button>
                    <button class="big-btn" style="padding: 10px 20px;" onclick="exportCSV()">CSV</button>
                    <button class="big-btn" style="padding: 10px 20px; background: var(--accent); border:none;" onclick="generateReport()">Report</button>
                </div>
            </div>

            <div class="history-grid-layout">
                <div>
                    <div class="cal-container">
                        <div class="cal-header">
                            <select id="sel-m" class="login-input" style="margin:0; padding:10px;" onchange="renderHistory()"></select>
                            <select id="sel-y" class="login-input" style="margin:0; padding:10px;" onchange="renderHistory()"></select>
                        </div>
                        <div class="cal-grid" id="cal-grid"></div>
                    </div>
                </div>

                <div class="activity-section">
                    <div style="margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px;">
                        <div style="font-size: 12px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1px;">Selected Date</div>
                        <div id="selected-date-label" style="font-size: 24px; font-weight: 700; color: #fff; margin-top: 5px;">--</div>
                    </div>
                    
                    <div id="attendance-detail" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                        <!-- Att cards injected here -->
                    </div>

                    <div id="hist-detail" style="display:flex; flex-direction:column; gap:12px;"></div>
                </div>
            </div>
        </div>

        <!-- SETTINGS -->
        <div id="settings" class="tab-panel">
            <h1 style="margin-bottom: 30px; font-size: 28px;">Settings</h1>
            
            <div class="settings-group">
                <div class="settings-label">Profile & Security</div>
                <div class="settings-list">
                    <div class="setting-item" onclick="openModal('company-modal')">
                        <div class="setting-icon">üë§</div>
                        <div>
                            <div style="font-weight: 700; color: #fff;">Profile Identity</div>
                            <div style="font-size: 12px; color: var(--text-dim);">Name, Company details</div>
                        </div>
                    </div>
                    <div class="setting-item" onclick="openModal('pass-modal')">
                        <div class="setting-icon">üîí</div>
                        <div>
                            <div style="font-weight: 700; color: #fff;">Admin Access</div>
                            <div style="font-size: 12px; color: var(--text-dim);">Password protection</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-label">Appearance</div>
                <div class="settings-list" style="padding: 20px;">
                    <div class="color-grid">
                        <div onclick="setTheme('#8b5cf6')" id="swatch-#8b5cf6" class="color-dot" style="background:#8b5cf6"></div>
                        <div onclick="setTheme('#ff4d4d')" id="swatch-#ff4d4d" class="color-dot" style="background:#ff4d4d"></div>
                        <div onclick="setTheme('#2979ff')" id="swatch-#2979ff" class="color-dot" style="background:#2979ff"></div>
                        <div onclick="setTheme('#00e676')" id="swatch-#00e676" class="color-dot" style="background:#00e676"></div>
                        <div onclick="setTheme('#ffb300')" id="swatch-#ffb300" class="color-dot" style="background:#ffb300"></div>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-label">Data</div>
                <div class="settings-list">
                    <div class="setting-item" onclick="exportData()">
                        <div class="setting-icon">‚òÅÔ∏è</div>
                        <div><div style="font-weight: 700; color: #fff;">Backup Data</div></div>
                    </div>
                    <div class="setting-item" onclick="document.getElementById('import-file').click()">
                        <div class="setting-icon">üì•</div>
                        <div><div style="font-weight: 700; color: #fff;">Restore Data</div></div>
                        <input type="file" id="import-file" style="display:none" onchange="importData(this)">
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-label" style="color: var(--danger);">Danger Zone</div>
                <div class="settings-list" style="border-color: rgba(255, 77, 77, 0.3);">
                    <div class="setting-item" onclick="promptAuth('reset_today')">
                        <div class="setting-icon" style="color: var(--danger);">‚Ü∫</div>
                        <div style="font-weight: 700; color: var(--danger);">Reset Today</div>
                    </div>
                    <div class="setting-item" onclick="promptAuth('master_reset')">
                        <div class="setting-icon" style="color: var(--danger);">‚úï</div>
                        <div style="font-weight: 700; color: var(--danger);">Master Reset</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="fab" id="main-fab" onclick="openModal('task-modal')">+</div>

    <!-- MODALS -->
    <div class="modal" id="task-modal">
        <div class="modal-box">
            <h2>New Task</h2>
            <input type="text" id="task-input" class="login-input" placeholder="What are you working on?">
            <select id="category-input" class="login-input" style="appearance: none;">
                <option value="Training">Training</option>
                <option value="Demo">Demo</option>
                <option value="Troubleshooting">Troubleshooting</option>
                <option value="Development">Development</option>
                <option value="No Work">No Work</option>
            </select>
            <button onclick="saveTask()" class="btn-login">Create</button>
            <button onclick="closeModal('task-modal')" class="btn-login" style="background:transparent; border:1px solid var(--border); margin-top:10px;">Cancel</button>
        </div>
    </div>
    
    <div class="modal" id="company-modal"><div class="modal-box"><h2>Profile</h2><input type="text" id="setup-comp" class="login-input" placeholder="Company Name"><input type="text" id="setup-user" class="login-input" placeholder="Your Name"><input type="text" id="setup-desig" class="login-input" placeholder="Designation"><button onclick="saveCompanyProfile()" class="btn-login">Save Changes</button><button onclick="closeModal('company-modal')" class="btn-login" style="background:transparent; margin-top:10px;">Cancel</button></div></div>
    
    <div class="modal" id="pass-modal">
        <div class="modal-box">
            <h2>Security</h2>
            <input type="password" id="old-pass" class="login-input" placeholder="Current Password">
            <input type="password" id="new-pass" class="login-input" placeholder="New Password">
            <p style="text-align:right; font-size:12px; color:var(--accent); cursor:pointer; margin-top:5px;" onclick="openModal('super-reset-modal')">Forgot Password?</p>
            <button onclick="updateAdminPassword()" class="btn-login">Update</button>
            <button onclick="closeModal('pass-modal')" class="btn-login" style="background:transparent; margin-top:10px;">Cancel</button>
        </div>
    </div>

    <div class="modal" id="leave-modal">
        <div class="modal-box">
            <h2>Mark Leave</h2>
            <p id="leave-date-display" style="color:var(--accent); margin-bottom:20px; font-weight:700;"></p>
            <div style="display:flex; gap:10px;">
                <button class="btn-login" style="margin-top:0; background:#222;" onclick="showHalfDayOpts()">Half Day</button>
                <button class="btn-login" style="margin-top:0; background:var(--danger);" onclick="confirmLeave('Full Day')">Full Day</button>
            </div>
            <div id="half-day-opts" style="display:none; gap:10px; margin-top:10px;">
                <button class="btn-login" style="margin-top:0; background:var(--warning); color:#000;" onclick="confirmLeave('Half Day - Morning')">Morning</button>
                <button class="btn-login" style="margin-top:0; background:var(--warning); color:#000;" onclick="confirmLeave('Half Day - Evening')">Evening</button>
            </div>
            <button onclick="closeModal('leave-modal')" class="btn-login" style="background:transparent; margin-top:15px;">Cancel</button>
        </div>
    </div>

    <div class="modal" id="denied-modal">
        <div class="modal-box" style="text-align: center; border-color: var(--danger);">
            <h2 style="color: var(--danger);">Action Required</h2>
            <p style="color: var(--text-dim); margin-bottom: 20px;">You must <b>Punch In</b> to start tracking tasks.</p>
            <button onclick="closeModal('denied-modal')" class="btn-login" style="background: var(--danger);">Understood</button>
        </div>
    </div>

    <div class="modal" id="auth-modal">
        <div class="modal-box">
            <h2 id="auth-title">Verify</h2>
            <input type="password" id="auth-pass" class="login-input" placeholder="Admin Password">
            <button id="auth-btn" onclick="verifyAuth()" class="btn-login" style="background:var(--danger);">Confirm</button>
            <button onclick="closeModal('auth-modal')" class="btn-login" style="background:transparent; margin-top:10px;">Cancel</button>
        </div>
    </div>

    <div class="modal" id="report-modal">
        <div class="modal-box" style="max-width:900px; height:90vh; overflow-y:auto; background:white; color:black;">
            <div id="report-area"></div>
            <div class="no-print" style="margin-top:20px; display:flex; gap:10px;">
                <button onclick="printReport()" class="btn-login" style="margin-top:0;">Print PDF</button>
                <button onclick="closeModal('report-modal')" class="btn-login" style="margin-top:0; background:#333;">Close</button>
            </div>
        </div>
    </div>

    <!-- Super Admin & Reset Modals (Hidden for brevity, logic remains same) -->
    <div class="modal" id="super-reset-modal"><div class="modal-box"><h2>Developer Auth</h2><input type="password" id="super-admin-key" class="login-input" placeholder="Key"><button onclick="verifySuperAdminAndOpenReset()" class="btn-login">Verify</button><button onclick="closeModal('super-reset-modal')" class="btn-login" style="background:transparent; margin-top:10px;">Cancel</button></div></div>
    <div class="modal" id="new-admin-pass-modal"><div class="modal-box"><h2>Reset Password</h2><input type="password" id="reset-new-pass" class="login-input" placeholder="New Password"><button onclick="finalizeAdminReset()" class="btn-login">Set Password</button></div></div>

<script>
    const SUPER_ADMIN_PASS = "spa@cad";
    let adminPass = localStorage.getItem('s_admin_pass') || "123";
    let companyProfile = JSON.parse(localStorage.getItem('s_profile'));
    let tasks = JSON.parse(localStorage.getItem('s_tasks')) || [];
    let logs = JSON.parse(localStorage.getItem('s_logs_v4')) || {};
    let attendance = JSON.parse(localStorage.getItem('s_attendance')) || {};
    let activeId = localStorage.getItem('s_activeId') ? parseInt(localStorage.getItem('s_activeId')) : null;
    let timer, selectedDate = null;
    let pendingAuthAction = null; let pendingTaskId = null;

    const mS = document.getElementById('sel-m'), yS = document.getElementById('sel-y'), now = new Date();
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    
    months.forEach((m, i) => mS.innerHTML += `<option value="${i}" ${i==now.getMonth()?'selected':''}>${m}</option>`);
    for(let y=2024; y<=2035; y++) yS.innerHTML += `<option value="${y}" ${y==now.getFullYear()?'selected':''}>${y}</option>`;

    window.addEventListener('load', () => {
        setTimeout(() => {
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => { 
                document.getElementById('splash-screen').style.visibility = 'hidden';
                if(!companyProfile) {
                    const login = document.getElementById('login-screen');
                    login.style.display = 'flex';
                    setTimeout(() => login.classList.add('visible'), 50);
                } else {
                    updateProfileUI();
                }
            }, 800); 
        }, 2000);
        setTheme(localStorage.getItem('s_theme') || '#8b5cf6');
    });

    function completeRegistration() {
        const comp = document.getElementById('reg-comp').value.trim();
        const user = document.getElementById('reg-user').value.trim();
        const desig = document.getElementById('reg-desig').value.trim();
        if(!comp || !user || !desig) return alert("Fill all fields");
        companyProfile = { company: comp, name: user, desig: desig };
        localStorage.setItem('s_profile', JSON.stringify(companyProfile));
        document.getElementById('login-screen').style.opacity = '0';
        setTimeout(() => { document.getElementById('login-screen').style.display = 'none'; }, 500);
        updateProfileUI();
    }

    function setTheme(color) {
        document.documentElement.style.setProperty('--accent', color);
        document.documentElement.style.setProperty('--accent-glow', color + '66');
        localStorage.setItem('s_theme', color);
        document.querySelectorAll('.color-dot').forEach(el => el.classList.remove('active'));
        const active = document.getElementById('swatch-'+color);
        if(active) active.classList.add('active');
    }

    function formatTime(ts) { return new Date(ts).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); }
    function format(s) {
        const h = Math.floor(s/3600).toString().padStart(2,'0');
        const m = Math.floor((s%3600)/60).toString().padStart(2,'0');
        const sec = (s%60).toString().padStart(2,'0');
        return `${h}:${m}:${sec}`;
    }

    function updateProfileUI() {
        if(companyProfile) {
            document.getElementById('side-user-name').innerText = companyProfile.name;
            document.getElementById('side-comp-name').innerText = companyProfile.company;
            document.getElementById('setup-comp').value = companyProfile.company;
            document.getElementById('setup-user').value = companyProfile.name;
            document.getElementById('setup-desig').value = companyProfile.desig;
        }
    }

    function openModal(id) { 
        const m = document.getElementById(id); m.style.display = 'flex'; 
        setTimeout(() => m.querySelector('.modal-box').style.transform = 'translateY(0)', 10);
    }
    function closeModal(id) { 
        const m = document.getElementById(id);
        m.querySelector('.modal-box').style.transform = 'translateY(20px)';
        setTimeout(() => m.style.display = 'none', 300);
    }

    function saveTask() {
        const input = document.getElementById('task-input'), cat = document.getElementById('category-input').value;
        if(input.value) {
            tasks.push({ id: Date.now(), name: input.value, category: cat });
            localStorage.setItem('s_tasks', JSON.stringify(tasks));
            input.value = ''; closeModal('task-modal'); renderDashboard();
        }
    }
    function deleteTask(id) { pendingTaskId = id; promptAuth('delete_task'); }

    function saveCompanyProfile() {
        companyProfile = { company: document.getElementById('setup-comp').value, name: document.getElementById('setup-user').value, desig: document.getElementById('setup-desig').value };
        localStorage.setItem('s_profile', JSON.stringify(companyProfile));
        updateProfileUI(); closeModal('company-modal');
    }

    function handlePunch() {
        const key = new Date().toISOString().split('T')[0], time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        if (!attendance[key]) attendance[key] = { in: null, out: null };
        
        if (!attendance[key].in) attendance[key].in = time;
        else {
            if (activeId) toggle(activeId);
            attendance[key].out = time;
        }
        localStorage.setItem('s_attendance', JSON.stringify(attendance));
        updatePunchUI();
    }

    function updatePunchUI() {
        const key = new Date().toISOString().split('T')[0], day = attendance[key];
        const btn = document.getElementById('punch-btn'), status = document.getElementById('punch-status-text'), dot = document.getElementById('status-dot'), disp = document.getElementById('punch-time-display');
        
        if (!day || !day.in) { 
            btn.innerText = "Punch In"; btn.classList.remove('out'); 
            status.innerText = "Not Started"; dot.classList.remove('active'); disp.innerText = "--:--"; 
        } else if (day.in && !day.out) { 
            btn.innerText = "Punch Out"; btn.classList.add('out'); 
            status.innerText = "Active Shift"; dot.classList.add('active'); disp.innerText = "In: " + day.in; 
        } else { 
            btn.style.display = "none"; 
            status.innerText = "Shift Completed"; dot.classList.remove('active'); disp.innerText = `${day.in} - ${day.out}`; 
        }
    }

    function renderDashboard() {
        const list = document.getElementById('task-list'), key = new Date().toISOString().split('T')[0];
        let total = 0;
        document.getElementById('task-count').innerText = tasks.length + " Tasks";
        
        list.innerHTML = tasks.map(t => {
            let s = 0; if(logs[key] && logs[key][t.id]) logs[key][t.id].forEach(sess => s += Math.floor(((sess.end || Date.now()) - sess.start)/1000));
            total += s; const isRunning = (activeId === t.id);
            return `<div class="task-card ${isRunning ? 'active-task' : ''}">
                <div class="task-info">
                    <h3>${t.name}</h3>
                    <div class="task-meta"><span class="task-cat">${t.category}</span><span class="task-time">${format(s)}</span></div>
                </div>
                <div class="task-controls">
                    <button class="btn-icon" onclick="deleteTask(${t.id})">üóë</button>
                    <button class="play-toggle ${isRunning ? 'playing' : ''}" onclick="toggle(${t.id})">${isRunning ? '‚è∏' : '‚ñ∂'}</button>
                </div>
            </div>`;
        }).join('');
        document.getElementById('master-clock').innerText = format(total);
        updatePunchUI(); updateProfileUI();
    }

    function toggle(id) {
        const key = new Date().toISOString().split('T')[0], att = attendance[key];
        if (!att || !att.in || att.out) { openModal('denied-modal'); return; }
        
        if(!logs[key]) logs[key] = {}; if(!logs[key][id]) logs[key][id] = [];
        if(activeId === id) {
            clearInterval(timer); timer = null;
            logs[key][id][logs[key][id].length - 1].end = Date.now();
            activeId = null; localStorage.removeItem('s_activeId');
        } else {
            if(activeId && logs[key][activeId]) { 
                let last = logs[key][activeId][logs[key][activeId].length-1]; 
                if(last && !last.end) last.end = Date.now(); 
            }
            activeId = id; localStorage.setItem('s_activeId', id);
            logs[key][id].push({ start: Date.now(), end: null });
            if(!timer) timer = setInterval(renderDashboard, 1000);
        }
        localStorage.setItem('s_logs_v4', JSON.stringify(logs)); renderDashboard();
    }

    function renderHistory() {
        const grid = document.getElementById('cal-grid'); grid.innerHTML = '';
        const m = parseInt(mS.value), y = parseInt(yS.value);
        const first = new Date(y, m, 1).getDay(), total = new Date(y, m+1, 0).getDate();
        for(let i=0; i<first; i++) grid.appendChild(Object.assign(document.createElement('div'), {className: 'cal-day empty'}));
        for(let i=1; i<=total; i++) {
            const dStr = `${y}-${(m+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`;
            const div = document.createElement('div');
            const att = attendance[dStr];
            let classes = 'cal-day';
            if(att) {
                if(att.leaveType === 'Full Day') classes += ' leave-full';
                else if(att.leaveType && att.leaveType.includes('Half')) classes += ' leave-half';
                else if(logs[dStr] || att.in) classes += ' has-data';
            }
            if(selectedDate === dStr) classes += ' selected';
            div.className = classes; div.innerText = i; div.onclick = () => { selectedDate = dStr; renderHistory(); showHist(dStr); };
            grid.appendChild(div);
        }
    }

    function promptLeaveOptions() {
        if(!selectedDate) return alert("Select a date first.");
        document.getElementById('leave-date-display').innerText = new Date(selectedDate).toDateString();
        document.getElementById('half-day-opts').style.display = 'none'; openModal('leave-modal');
    }
    function showHalfDayOpts() { document.getElementById('half-day-opts').style.display = 'flex'; }
    function confirmLeave(type) {
        attendance[selectedDate] = { in: type, out: type, isLeave: true, leaveType: type };
        localStorage.setItem('s_attendance', JSON.stringify(attendance));
        renderHistory(); showHist(selectedDate); closeModal('leave-modal');
    }

    function showHist(date) {
        document.getElementById('selected-date-label').innerText = new Date(date).toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
        const att = attendance[date], attArea = document.getElementById('attendance-detail'), workArea = document.getElementById('hist-detail');
        
        attArea.innerHTML = att ? 
            `<div style="background:var(--card-bg); padding:15px; border-radius:15px; border:1px solid var(--border);"><div style="font-size:10px; color:var(--text-dim); text-transform:uppercase;">Punch In</div><div style="font-size:20px; font-weight:700;">${att.in || '--:--'}</div></div>
             <div style="background:var(--card-bg); padding:15px; border-radius:15px; border:1px solid var(--border);"><div style="font-size:10px; color:var(--text-dim); text-transform:uppercase;">Punch Out</div><div style="font-size:20px; font-weight:700;">${att.out || '--:--'}</div></div>` 
            : `<div style="grid-column: span 2; color:var(--text-muted); text-align:center; padding:20px;">No attendance record</div>`;
            
        const dayData = logs[date];
        if(!dayData || Object.keys(dayData).length === 0) { workArea.innerHTML = `<div style="text-align:center; margin-top:20px; color:var(--text-muted);">No tasks recorded</div>`; return; }
        workArea.innerHTML = Object.keys(dayData).map(tid => {
            const t = tasks.find(x => x.id == tid) || {name: 'Deleted Task', category: 'Archive'};
            const tot = dayData[tid].reduce((acc, s) => acc + Math.floor(((s.end||Date.now())-s.start)/1000), 0);
            return `<div style="background:var(--card-bg); padding:20px; border-radius:20px; border:1px solid var(--border);"><div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span style="font-weight:700;">${t.name}</span><span style="font-family:monospace; color:var(--accent); font-weight:700;">${format(tot)}</span></div>
            ${dayData[tid].map(s => `<div style="font-size:12px; color:var(--text-dim); display:flex; justify-content:space-between; margin-top:5px; padding-top:5px; border-top:1px solid rgba(255,255,255,0.05);"><span>Session</span><span>${formatTime(s.start)} - ${s.end?formatTime(s.end):'...'}</span></div>`).join('')}</div>`;
        }).join('');
    }

    function generateReport() {
        if(!companyProfile) return alert("Profile error");
        const m = parseInt(mS.value), y = parseInt(yS.value), total = new Date(y, m+1, 0).getDate();
        let html = `<div style="font-family:sans-serif; padding:40px;"><h1 style="margin-bottom:5px;">${companyProfile.company}</h1><p style="color:#666;">${companyProfile.name} | ${companyProfile.desig}<br>${months[m]} ${y}</p><table style="width:100%; border-collapse:collapse; margin-top:20px;"><thead><tr style="background:#f0f0f0;"><th style="border:1px solid #ddd; padding:10px;">Date</th><th>In</th><th>Out</th><th>Hours</th></tr></thead><tbody>`;
        let g = 0; for(let i=1; i<=total; i++) {
            const dStr = `${y}-${(m+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`, att = attendance[dStr] || {in:'-', out:'-'};
            let dS = 0; if(logs[dStr]) Object.values(logs[dStr]).forEach(ts => ts.forEach(s => dS += Math.floor(((s.end||s.start)-s.start)/1000)));
            if(att.isLeave) dS = 0; else g += dS;
            let inT = att.in, outT = att.out;
            if(att.leaveType === 'Full Day') { inT = 'LEAVE'; outT='LEAVE'; }
            html += `<tr><td style="border:1px solid #ddd; padding:8px; text-align:center;">${i}</td><td style="border:1px solid #ddd; padding:8px; text-align:center;">${inT}</td><td style="border:1px solid #ddd; padding:8px; text-align:center;">${outT}</td><td style="border:1px solid #ddd; padding:8px; text-align:center;">${att.isLeave?'-':format(dS)}</td></tr>`;
        }
        html += `</tbody></table><h3 style="text-align:right; margin-top:20px;">Total: ${format(g)}</h3></div>`;
        document.getElementById('report-area').innerHTML = html; openModal('report-modal');
    }
    
    function printReport() {
        const w = window.open(); w.document.write(document.getElementById('report-area').innerHTML); w.print(); w.close();
    }
    function exportCSV() {
        const m = parseInt(mS.value), y = parseInt(yS.value), total = new Date(y, m+1, 0).getDate();
        let csv = "Date,In,Out,Hours\n";
        for(let i=1; i<=total; i++) {
             const dStr = `${y}-${(m+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`, att = attendance[dStr] || {in:'-', out:'-'};
             let dS = 0; if(logs[dStr]) Object.values(logs[dStr]).forEach(ts => ts.forEach(s => dS += Math.floor(((s.end||s.start)-s.start)/1000)));
             csv += `${dStr},${att.in},${att.out},${format(dS)}\n`;
        }
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'})); a.download = 'Log.csv'; a.click();
    }
    function exportData() {
        const d = { tasks, logs, attendance, profile: companyProfile };
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(d)], {type:'application/json'})); a.download = 'Backup.json'; a.click();
    }
    function importData(input) {
        const r = new FileReader(); r.onload = e => { if(confirm("Overwrite?")) { const d = JSON.parse(e.target.result); if(d.tasks) localStorage.setItem('s_tasks',JSON.stringify(d.tasks)); if(d.logs) localStorage.setItem('s_logs_v4',JSON.stringify(d.logs)); location.reload(); }}; r.readAsText(input.files[0]);
    }

    function promptAuth(a) { pendingAuthAction = a; document.getElementById('auth-pass').value = ''; openModal('auth-modal'); }
    function verifyAuth() {
        const p = document.getElementById('auth-pass').value;
        if(p === adminPass || p === SUPER_ADMIN_PASS) {
            if(pendingAuthAction === 'reset_today') { const k = new Date().toISOString().split('T')[0]; delete logs[k]; delete attendance[k]; if(activeId) { clearInterval(timer); activeId=null; localStorage.removeItem('s_activeId'); } localStorage.setItem('s_logs_v4',JSON.stringify(logs)); localStorage.setItem('s_attendance',JSON.stringify(attendance)); renderDashboard(); }
            else if(pendingAuthAction === 'master_reset') { localStorage.clear(); location.reload(); }
            else if(pendingAuthAction === 'delete_task') { if(activeId === pendingTaskId) toggle(pendingTaskId); tasks = tasks.filter(t => t.id !== pendingTaskId); localStorage.setItem('s_tasks',JSON.stringify(tasks)); renderDashboard(); }
            closeModal('auth-modal');
        } else alert("Invalid");
    }
    function updateAdminPassword() { const o = document.getElementById('old-pass').value, n = document.getElementById('new-pass').value; if(o===adminPass) { adminPass=n; localStorage.setItem('s_admin_pass',n); closeModal('pass-modal'); } else alert("Wrong password"); }
    function verifySuperAdminAndOpenReset() { if(document.getElementById('super-admin-key').value === SUPER_ADMIN_PASS) { closeModal('super-reset-modal'); openModal('new-admin-pass-modal'); } else alert("Invalid"); }
    function finalizeAdminReset() { const n = document.getElementById('reset-new-pass').value; if(n) { adminPass=n; localStorage.setItem('s_admin_pass',n); closeModal('new-admin-pass-modal'); } }

    function switchTab(t) {
        document.querySelectorAll('.tab-panel, .nav-btn').forEach(x => x.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        const m = document.getElementById('m-'+t), d = document.getElementById('d-'+t);
        if(m) m.classList.add('active'); if(d) d.classList.add('active');
        document.getElementById('main-fab').style.display = t==='dashboard'?'flex':'none';
        if(t==='history') { if(!selectedDate) selectedDate = new Date().toISOString().split('T')[0]; renderHistory(); showHist(selectedDate); }
    }

    renderDashboard();
    if(activeId) timer = setInterval(renderDashboard, 1000);
</script>
</body>
</html>
